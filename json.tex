\documentclass{article}
\usepackage{expl3}

\ExplSyntaxOn

\cs_set_nopar:Npn \exp_args:NNff { \::N \::f \::f \::: }
\cs_set_nopar:Npn \exp_args:NNfff { \::N \::f \::f \::f \::: }
\cs_set_nopar:Npn \exp_args:NNNff { \::N \::N \::f \::f \::: }
\cs_set_nopar:Npn \exp_args:NNffff { \::N \::f \::f \::f \::f \::: }
\cs_set_nopar:Npn \exp_args:NNNfff { \::N \::N \::f \::f \::f \::: }
\cs_set_nopar:Npn \exp_args:NNcfff { \::N \::c \::f \::f \::f \::: }

\cs_new:Npn \inside_name:Nnn #1#2#3 {
  % #1 is a proplist
  \tl_set:Nn \name { #2 }
  \tl_set:Nf \car_input { \tl_head:n { #3 } }
  \tl_set:Nf \cdr_input { \tl_tail:n { #3 } }

  \tl_if_head_is_group:nTF { #3 }
     {
       \exp_args:NNff \inside_name:Nnn #1 {} { \car_input \relax \cdr_input }
     }
     { \tl_if_head_eq_charcode:nNTF { #3 } { : }
       {
         \exp_args:NNfff \inside_val:Nnnn #1 {} { \name } \cdr_input
       }
       { 
         \tl_set:Nx \app_name { \name\car_input }         
         \exp_args:NNff \inside_name:Nnn #1 { \app_name } { \cdr_input }
       }
     }
}

\cs_new:Npn \inside_val:Nnnn #1#2#3#4 {
  % #1 is a proplist
  \tl_set:Nn \val { #2 }
  \tl_set:Nn \name { #3 }
  \tl_set:Nf \car_input { \tl_head:n { #4 } }
  \tl_set:Nf \cdr_input { \tl_tail:n { #4 } }

  \tl_if_head_is_group:nTF { #4 }
     {
       \exp_args:NNfff \inside_val:Nnnn #1 { \car_input } { \name } { \cdr_input }
     }
     { \tl_if_head_eq_charcode:nNTF { #4 } { , }
       {
         \exp_args:NNff \add_key_val:Nnn #1 { \name } { \val }
         \exp_args:NNff \inside_name:Nnn #1 {} { \cdr_input }
       }
       { \tl_if_head_eq_charcode:nNTF { #4 } { [ }
         {
           \cs_if_exist:cTF { seq_\name }
              {\cs_undefine:c { seq_\name }}
              {}
           \seq_new:c { seq_\name }
           
           \exp_args:NNcfff \inside_array:Nnnnn #1 { seq_\name } {} { \name } { \cdr_input }
         }  
         { \tl_if_head_eq_charcode:nNTF { #4 } { " }
           {
             \exp_args:NNf \inside_string #1 { \name } #4
           }
           { \tl_if_head_eq_meaning:nNTF { #4 } { \relax }
             {
               \exp_args:NNff \add_key_val:Nnn #1 { \name } { \val }
             }
             {
               \tl_set:Nx \app_val { \val\car_input }
               \exp_args:NNfff \inside_val:Nnnn #1 { \app_val } { \name } { \cdr_input }
             }
           }
         }
       }
     }
}

% No double quotation within a string
\cs_new:Npn \inside_string #1#2"#3"#4\relax {
  % #1 is a control sequence for a proplist
  \tl_set:Nn \name { #2 }
  \tl_set:Nn \jsonstr { \tl_to_str:n { #3 } }

  \exp_args:NNNff \inside_val:Nnnn #1 \jsonstr { \name } { #4\relax }
}

% returns the seqence name as string, since proplist is able to hold only text
\cs_new:Npn \inside_array:Nnnnn #1#2#3#4#5 {
  % #1 is a proplist
  % #2 is a sequence
  \tl_set:Nn \array_item { #3 }
  \tl_set:Nn \name { #4 }
  \tl_set:Nf \car_input { \tl_head:n { #5 } }
  \tl_set:Nf \cdr_input { \tl_tail:n { #5 } }

  \tl_if_head_is_group:nTF { #4 }
     {
       \exp_args:NNNfff \inside_array:Nnnnn #1 #2 { \car_input } { \name } { \cdr_input }
     }
     { \tl_if_head_eq_charcode:nNTF { #5 } { ] }
       {
         \add_array_item:Nn #2 { \array_item }
         \exp_args:NNfff \inside_val:Nnnn #1 { \cs_to_str:N #2 } { \name } { \cdr_input }
       }
       { \tl_if_head_eq_charcode:nNTF { #5 } { , }
         {
           \add_array_item:Nn #2 { \array_item }
           \exp_args:NNNfff \inside_array:Nnnnn #1 #2 {} { \name } { \cdr_input }
         }
         {
           \exp_args:NNNfff \inside_array:Nnnnn #1 #2 { \array_item\car_input } { \name } { \cdr_input }
         }
       }
     }
}


\cs_new:Npn \add_array_item:Nn #1#2 {
  \exp_args:NNf \seq_put_right:Nn #1 { #2 }
}

\cs_new:Npn \add_key_val:Nnn #1#2#3 {
  \exp_args:NNff \prop_put:Nnn #1 { #2 } { #3 }
}

\def\readJson#1#2{%
  \prop_new:N #1
  \tl_set:Nn \cdr_input { \tl_tail:n { #2 } }
  \exp_args:NNff \inside_name:Nnn #1 {} { #2 }
}

\def\showById#1#2{%
  \prop_item:Nn #1 { #2 }
}

\def\getById#1#2#3{%
  \prop_get:NnN #1 { #2 } #3
}

\def\showArray#1{%
  \seq_use:cnnn { #1 } { ~and~ } { ,~ } { ,~and~ }
}

\def\showWeather#1{%
  \seq_map_function:cN #1 \format_weather:n
}

\def\showForecast#1{%
  \seq_map_function:cN #1 \format_forecast:n
}

\cs_new:Npn \format_forecast:n #1 {
  \readJson{\temp_forecast}{{#1}}
  \edef\weather{\showById{\temp_forecast}{"weather"}}
  \showWeather{\weather}
  \cs_undefine:N \temp_forecast
}

\cs_new:Npn \format_weather:n #1 {
  \readJson{\temp_data}{{#1}}
  \str_set:Nx \str_the_weather { \showById{\temp_data}{"main"} }

  \str_case:onTF { \str_the_weather }
      {
        {Clouds} { â˜ƒ }
      }
      { \par }
      { \str_the_weather \par }
  \cs_undefine:N \temp_data
}

\def\showTugDesc#1{%
  \seq_map_function:cN #1 \format_tugdesc:n
}

\cs_new:Npn \format_tugdesc:n #1 {
  \readJson{\temp_desc}{{#1}}
  \showById{\temp_desc}{"text"}
  \cs_undefine:N \temp_desc
}



\ExplSyntaxOff

\begin{document}

\makeatletter


%\readJson{\weather}{{"coord":{"lon":139.69,"lat":35.69},"weather":[{"id":801,"main":"Clouds","description":"few clouds","icon":"02n"}],"base":"stations","main":{"temp":285.15,"pressure":1023,"humidity":66,"temp_min":285.15,"temp_max":285.15},"visibility":10000,"wind":{"speed":2.1,"deg":70},"clouds":{"all":20},"dt":1482219420,"sys":{"type":1,"id":7619,"message":0.2123,"country":"JP","sunrise":1482184008,"sunset":1482219076},"id":1850147,"name":"Tokyo","cod":200}}

%\newread\injson \openin\injson=weather.json
%\read\injson to \data
%\readJson{\TokyoJp}{\data}

\newread\injson \openin\injson=forecast.json
\read\injson to \forecast
\readJson{\TokyoJpForecast}{\forecast}

%\edef\tokyoforecast{\showById{\TokyoJpForecast}{"list"}}
%\showForecast{\tokyoforecast}

\getById{\TokyoJpForecast}{"city"}{\cityValue}
\readJson{\cityName}{{\cityValue}}
\message{\showById{\cityName}{"name"}}

%\showArray{\tokyoweather}%\showById{\TokyoJp}{"weather"}}

%\showById{\TokyoJp}{"weather"}
%\readJson{\TokyoWeater}{{\temp}}


%%% CTAN example
%\newread\injson \openin\injson=tug.json
%\read\injson to \tugdata
%\readJson{\TugData}{\tugdata}
%\showById{\TugData}{"name"}
%\edef\texdesc{\showById{\TugData}{"descriptions"}}
%\showTugDesc{\texdesc}


%%% test example
% \readJson{\MyJson}{{id:[1,2,3], class:foo, data:{id:456}, info:"Is this a text?", hoge:"foo"}}
%id = \showArray{\showById{\MyJson}{id}} \par
%class = \showById{\MyJson}{class} \par 
%data = \showById{\MyJson}{data} \par
%info = \showById{\MyJson}{info} \par
%\getById{\MyJson}{data}{\MyJsonData}
%\readJson{\temp}{{\MyJsonData}}
%data.id = \showById{\temp}{id} \par

\makeatother

\end{document}
